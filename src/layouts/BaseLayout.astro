---
import BaseHeader from "../components/BaseHeader.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import { ViewTransitions } from "astro:transitions";

const { title } = Astro.props;

const isStaging = import.meta.env.MODE == "staging";
---

<script is:inline>
  function applyTheme() {
    const theme = (() => {
      if (
        typeof localStorage !== "undefined" &&
        localStorage.getItem("theme")
      ) {
        return localStorage.getItem("theme");
      }
      if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
        return "dark";
      }
      return "light";
    })();

    if (theme === "light") {
      document.documentElement.style.colorScheme = "light";
      document.documentElement.classList.remove("dark");
    } else {
      document.documentElement.style.colorScheme = "dark";
      document.documentElement.classList.add("dark");
    }
  }

  document.addEventListener("astro:after-swap", applyTheme);
  applyTheme();
</script>

<html lang="en">
  <head>
    <BaseHeader title={title} />
    <Header />
    <ViewTransitions />
  </head>
  <body
    class="bg-stone-100 dark:bg-stone-950 text-zinc-800 dark:text-zinc-200 min-h-screen flex flex-col justify-between"
  >
    {isStaging && (
      <div class="fixed top-0 left-0 z-50">
        <svg xmlns="http://www.w3.org/2000/svg" width="128" height="128" viewBox="0 0 128 128">
          <polygon points="128 0, 0 0, 0 128" style="fill:#7f1d1d;" />
        </svg>
        <div class="absolute top-7 left-0.5 -rotate-45 w-min">
          <p class="text-zinc-200 text-xl font-bold">Staging</p>
        </div>
      </div>
    )}
    <slot />
  </body><footer>
    <Footer />
  </footer>
</html>
